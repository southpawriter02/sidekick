# Sidekick v0.8.6 Changelog ‚Äî Conversation Memory

> **Release Date:** 2026-02-06  
> **Phase:** LLM Integration (v0.8.x)

---

## Summary

This release adds **Conversation Memory** ‚Äî long-term context and session persistence for the agent.

---

## New Features

### üß† Memory Types

| Type | Description | Default Importance |
|------|-------------|--------------------|
| `USER_MESSAGE` | User's input message | 0.6 |
| `ASSISTANT_MESSAGE` | Assistant's response | 0.5 |
| `TOOL_RESULT` | Result from tool execution | 0.4 |
| `FACT` | Extracted fact or knowledge | 0.7 |
| `PREFERENCE` | User preference | 0.8 |
| `CODE_CONTEXT` | Code context reference | 0.5 |
| `ERROR_CONTEXT` | Error or exception context | 0.6 |
| `DECISION` | Decision or conclusion | 0.7 |
| `SUMMARY` | Conversation summary | 0.6 |
| `SYSTEM_NOTE` | System note | 0.3 |

### üìã Session Tracking

- **Session creation**: Unique session per project
- **File tracking**: Track active files during session
- **Symbol tracking**: Track referenced symbols
- **Facts collection**: Collect facts during conversation
- **Duration tracking**: Session start/end times

### üîç Memory Recall

| Query Type | Description |
|------------|-------------|
| `recent()` | Get most recent memories |
| `semantic()` | Semantic similarity search |
| `forSession()` | Filter by session ID |
| `persistent()` | Facts and preferences only |

### ‚öôÔ∏è Configuration

| Setting | Default | Description |
|---------|---------|-------------|
| `enabled` | true | Enable memory system |
| `maxShortTermMemory` | 20 | Short-term memory limit |
| `maxLongTermMemory` | 1000 | Long-term memory limit |
| `retentionDays` | 30 | Days to retain memories |
| `embedMemories` | true | Generate embeddings |
| `autoSummarize` | true | Auto-summarize conversations |
| `importanceThreshold` | 0.3 | Minimum importance to persist |

---

## Components Added

### Models (`MemoryModels.kt`)

| Type | Description |
|------|-------------|
| `MemoryEntry` | Single memory entry with embedding |
| `MemoryType` | 10 memory types |
| `SessionContext` | Session tracking |
| `MemoryConfig` | Configuration settings |
| `MemoryQuery` | Query for recall |
| `MemoryStats` | Memory statistics |
| `MemoryEvent` | System events |
| `MemoryUtils` | Utility functions |

### Service (`MemoryService.kt`)

| Method | Description |
|--------|-------------|
| `startSession()` | Start new session |
| `endSession()` | End current session |
| `remember()` | Store memory entry |
| `recall()` | Recall memories |
| `getRecentMemories()` | Get recent memories |
| `getPersistentMemories()` | Get facts/preferences |
| `clearMemories()` | Clear all memories |
| `getStats()` | Get statistics |

---

## Files Changed

### New Files
- `src/main/kotlin/com/sidekick/agent/memory/MemoryModels.kt`
- `src/main/kotlin/com/sidekick/agent/memory/MemoryService.kt`
- `src/test/kotlin/com/sidekick/agent/memory/MemoryModelsTest.kt`
- `src/test/kotlin/com/sidekick/agent/memory/MemoryServiceTest.kt`

---

## Test Coverage

| Test Class | Tests | Coverage |
|------------|-------|----------|
| `MemoryModelsTest` | 35+ | Entry, types, session, config, query, utils |
| `MemoryServiceTest` | 25+ | Sessions, storage, recall, management |

---

## API Reference

### Remember & Recall
```kotlin
val memoryService = MemoryService.withoutEmbeddings(project.basePath ?: "")

// Start session
memoryService.startSession()

// Remember facts
memoryService.rememberFact("The project uses Kotlin 1.9")
memoryService.rememberPreference("User prefers dark mode")

// Remember messages
memoryService.rememberUserMessage("How do I fix this error?")
memoryService.rememberAssistantMessage("Let me analyze the stack trace...")

// Recall semantically (with embeddings)
val relevant = memoryService.recall("Kotlin version")

// Get recent
val recent = memoryService.getRecentMemories(10)

// Get facts
val persistent = memoryService.getPersistentMemories()
```

### Session Tracking
```kotlin
// Track file access
memoryService.trackFile("/src/main/kotlin/MyClass.kt")

// Track symbols
memoryService.trackSymbol("MyClass")
memoryService.trackSymbol("doSomething")

// Get session info
val session = memoryService.getCurrentSession()
println("Active files: ${session.activeFiles}")
println("Recent symbols: ${session.recentSymbols}")
println("Facts learned: ${session.facts}")
```

### Statistics
```kotlin
val stats = memoryService.getStats()
println("Total memories: ${stats.totalMemories}")
println("With embeddings: ${stats.memoriesWithEmbeddings}")
println("Embedding coverage: ${stats.embeddingCoverage}")
```

---

## Memory Utilities

```kotlin
// Cosine similarity for embeddings
val similarity = MemoryUtils.cosineSimilarity(embedding1, embedding2)

// Time decay factor
val decay = MemoryUtils.decayFactor(ageMs = 86400000, halfLifeMs = 43200000)

// Score memory for relevance
val score = MemoryUtils.scoreMemory(memory, querySimilarity = 0.9f)

// Extract keywords
val keywords = MemoryUtils.extractKeywords("The quick brown fox", maxKeywords = 5)
```

---

## Verification

```bash
./gradlew test --tests "com.sidekick.agent.memory.*"
# All tests passing
```
