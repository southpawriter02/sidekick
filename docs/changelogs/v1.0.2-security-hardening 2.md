# v1.0.2 - Security Hardening

> **Release Date:** 2026-02-06  
> **Category:** Security

---

## Overview

This version introduces **security hardening** features including command sandboxing, input validation, file access controls, and security event logging.

---

## New Features

### Security Module (`com.sidekick.security`)

#### Data Models (`SecurityModels.kt`)

| Type | Purpose |
|------|---------|
| `SecurityConfig` | Configuration for sandboxing, allowlists, blocked patterns |
| `ConfirmationLevel` | Enum: NONE, DESTRUCTIVE, ALL |
| `SecurityEvent` | Logged security event with severity and context |
| `SecurityEventType` | Enum for event categories |
| `SecuritySeverity` | Enum: INFO, WARNING, HIGH, CRITICAL |
| `ValidationResult` | Validation outcome with sanitized output |
| `SecurityIssue` | Individual security concern |

#### Command Sandbox (`CommandSandbox.kt`)

- **`validateCommand()`** - Validates commands against dangerous patterns and allowlist
- **`validateFileAccess()`** - Checks for path traversal and restricted paths
- **`sanitizeInput()`** - Removes dangerous characters from user input
- **`checkForInjection()`** - Detects potential shell injection
- Security event logging for all blocked operations

---

## Security Controls

### Dangerous Pattern Detection
Blocks commands matching:
- `rm -rf /` or `rm -rf ~`
- `sudo`, `su -`, `doas`
- `chmod 777`
- Piping to shell (`| sh`, `| bash`)
- `curl | sh` style attacks
- Writing to `/dev/`
- Fork bombs

### File Access Protection
- Path traversal detection (`..`)
- Restricted system paths (`/etc`, `/usr`, `/bin`, etc.)
- Symlink escape detection
- File size limits

---

## Test Coverage

| File | Tests | Coverage Areas |
|------|-------|----------------|
| `SecurityModelsTest.kt` | 35 | Data classes, enums, factories |
| `CommandSandboxTest.kt` | 30 | Patterns, allowlist, sanitization |

---

## Usage Example

```kotlin
val sandbox = CommandSandbox.getInstance()

// Validate command before execution
val result = sandbox.validateCommand("git push", "/path/to/project")
if (result.valid) {
    // Safe to execute
    executeCommand(result.sanitized!!)
} else {
    // Show issues to user
    println(result.formatIssues())
}

// Sanitize user input
val clean = sandbox.sanitizeInput(userInput)
```
