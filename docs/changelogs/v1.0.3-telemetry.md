# v1.0.3 - Telemetry (Opt-In)

> **Release Date:** 2026-02-06  
> **Category:** Analytics

---

## Overview

This version introduces **opt-in telemetry** for privacy-respecting usage analytics, crash reporting, and performance metrics.

> [!IMPORTANT]
> All telemetry is **disabled by default** and requires explicit opt-in.

---

## New Features

### Telemetry Module (`com.sidekick.telemetry`)

#### Data Models (`TelemetryModels.kt`)

| Type | Purpose |
|------|---------|
| `TelemetryConfig` | Opt-in configuration with granular controls |
| `TelemetryEvent` | Single tracked event with properties/metrics |
| `EventType` | Enum: FEATURE_USED, ERROR, PERFORMANCE, SESSION, FEEDBACK |
| `CrashReport` | Anonymized crash information |
| `CrashContext` | Environment details for debugging |
| `UsageStats` | Aggregated anonymized statistics |

#### Telemetry Service (`TelemetryService.kt`)

- **`trackFeature()`** - Track feature usage
- **`trackError()`** - Track anonymized errors
- **`trackPerformance()`** - Track operation metrics
- **`trackTimed()`** - Automatically time and track operations
- **`startSession()` / `endSession()`** - Session lifecycle
- Batched event queue with flush support
- Persistent configuration via `PersistentStateComponent`

---

## Privacy Model

| Principle | Implementation |
|-----------|----------------|
| Opt-in Only | Disabled by default, requires explicit enable |
| Granular Control | Toggle: usage, crashes, features, performance |
| Anonymized | No PII, sanitized stack traces |
| Local First | Events queued locally before flush |

---

## Test Coverage

| File | Tests |
|------|-------|
| `TelemetryModelsTest.kt` | ~35 |
| `TelemetryServiceTest.kt` | ~30 |

---

## Usage Example

```kotlin
val telemetry = TelemetryService.getInstance()

// Enable telemetry (user opt-in)
telemetry.updateConfig(TelemetryConfig(
    enabled = true,
    crashReporting = true,
    featureTracking = true
))

// Track feature usage
telemetry.trackFeature("chat_sent", mapOf("model" to "gpt-4"))

// Track with automatic timing
val result = telemetry.trackTimed("code_generation") {
    generateCode(prompt)
}
```
